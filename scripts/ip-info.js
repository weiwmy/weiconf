if ($response.statusCode !== 200) {
  $done(null);
}

const cityFallback = "æœªçŸ¥åŸå¸‚";
const ispFallback = "æœªçŸ¥ISP";

function validCity(city) {
  return city || cityFallback;
}

function validISP(isp) {
  return isp || ispFallback;
}

function firstWordISP(isp) {
  if (!isp) return ispFallback;
  return isp.trim().split(/\s+/)[0];
}

const flags = new Map([
  ["AC", "ğŸ‡¦ğŸ‡¨"], ["AE", "ğŸ‡¦ğŸ‡ª"], ["AF", "ğŸ‡¦ğŸ‡«"], ["AI", "ğŸ‡¦ğŸ‡®"], ["AL", "ğŸ‡¦ğŸ‡±"],
  ["AQ", "ğŸ‡¦ğŸ‡¶"], ["AR", "ğŸ‡¦ğŸ‡·"], ["AS", "ğŸ‡¦ğŸ‡¸"], ["AT", "ğŸ‡¦ğŸ‡¹"], ["AU", "ğŸ‡¦ğŸ‡º"],
  ["AW", "ğŸ‡¦ğŸ‡¼"], ["AX", "ğŸ‡¦ğŸ‡½"], ["AZ", "ğŸ‡¦ğŸ‡¿"], ["BA", "ğŸ‡§ğŸ‡¦"], ["BB", "ğŸ‡§ğŸ‡§"],
  ["BD", "ğŸ‡§ğŸ‡©"], ["BE", "ğŸ‡§ğŸ‡ª"], ["BF", "ğŸ‡§ğŸ‡«"], ["BG", "ğŸ‡§ğŸ‡¬"], ["BH", "ğŸ‡§ğŸ‡­"],
  ["BI", "ğŸ‡§ğŸ‡®"], ["BJ", "ğŸ‡§ğŸ‡¯"], ["BM", "ğŸ‡§ğŸ‡²"], ["BN", "ğŸ‡§ğŸ‡³"], ["BO", "ğŸ‡§ğŸ‡´"],
  ["BR", "ğŸ‡§ğŸ‡·"], ["BS", "ğŸ‡§ğŸ‡¸"], ["BT", "ğŸ‡§ğŸ‡¹"], ["BW", "ğŸ‡§ğŸ‡¼"], ["BY", "ğŸ‡§ğŸ‡¾"],
  ["BZ", "ğŸ‡§ğŸ‡¿"], ["CA", "ğŸ‡¨ğŸ‡¦"], ["CF", "ğŸ‡¨ğŸ‡«"], ["CH", "ğŸ‡¨ğŸ‡­"], ["CK", "ğŸ‡¨ğŸ‡°"],
  ["CL", "ğŸ‡¨ğŸ‡±"], ["CM", "ğŸ‡¨ğŸ‡²"], ["CN", "ğŸ‡¨ğŸ‡³"], ["CO", "ğŸ‡¨ğŸ‡´"], ["CR", "ğŸ‡¨ğŸ‡·"],
  ["CU", "ğŸ‡¨ğŸ‡º"], ["CV", "ğŸ‡¨ğŸ‡»"], ["CW", "ğŸ‡¨ğŸ‡¼"], ["CY", "ğŸ‡¨ğŸ‡¾"], ["CZ", "ğŸ‡¨ğŸ‡¿"],
  ["DE", "ğŸ‡©ğŸ‡ª"], ["DJ", "ğŸ‡©ğŸ‡¯"], ["DK", "ğŸ‡©ğŸ‡°"], ["DM", "ğŸ‡©ğŸ‡²"], ["DO", "ğŸ‡©ğŸ‡´"],
  ["DZ", "ğŸ‡©ğŸ‡¿"], ["EC", "ğŸ‡ªğŸ‡¨"], ["EE", "ğŸ‡ªğŸ‡ª"], ["EG", "ğŸ‡ªğŸ‡¬"], ["ES", "ğŸ‡ªğŸ‡¸"],
  ["ET", "ğŸ‡ªğŸ‡¹"], ["EU", "ğŸ‡ªğŸ‡º"], ["FI", "ğŸ‡«ğŸ‡®"], ["FJ", "ğŸ‡«ğŸ‡¯"], ["FR", "ğŸ‡«ğŸ‡·"],
  ["GA", "ğŸ‡¬ğŸ‡¦"], ["GB", "ğŸ‡¬ğŸ‡§"], ["HK", "ğŸ‡­ğŸ‡°"], ["HU", "ğŸ‡­ğŸ‡º"], ["ID", "ğŸ‡®ğŸ‡©"],
  ["IE", "ğŸ‡®ğŸ‡ª"], ["IL", "ğŸ‡®ğŸ‡±"], ["IN", "ğŸ‡®ğŸ‡³"], ["IS", "ğŸ‡®ğŸ‡¸"], ["IT", "ğŸ‡®ğŸ‡¹"],
  ["JP", "ğŸ‡¯ğŸ‡µ"], ["KR", "ğŸ‡°ğŸ‡·"], ["LU", "ğŸ‡±ğŸ‡º"], ["MO", "ğŸ‡²ğŸ‡´"], ["MX", "ğŸ‡²ğŸ‡½"],
  ["MY", "ğŸ‡²ğŸ‡¾"], ["NL", "ğŸ‡³ğŸ‡±"], ["PH", "ğŸ‡µğŸ‡­"], ["RO", "ğŸ‡·ğŸ‡´"], ["RS", "ğŸ‡·ğŸ‡¸"],
  ["RU", "ğŸ‡·ğŸ‡º"], ["RW", "ğŸ‡·ğŸ‡¼"], ["SA", "ğŸ‡¸ğŸ‡¦"], ["SC", "ğŸ‡¸ğŸ‡¨"], ["SE", "ğŸ‡¸ğŸ‡ª"],
  ["SG", "ğŸ‡¸ğŸ‡¬"], ["TH", "ğŸ‡¹ğŸ‡­"], ["TR", "ğŸ‡¹ğŸ‡·"], ["TW", "ğŸ‡¨ğŸ‡³"], ["US", "ğŸ‡ºğŸ‡¸"],
  ["VN", "ğŸ‡»ğŸ‡³"], ["ZA", "ğŸ‡¿ğŸ‡¦"], ["UA", "ğŸ‡ºğŸ‡¦"], ["NZ", "ğŸ‡³ğŸ‡¿"], ["PK", "ğŸ‡µğŸ‡°"],
  ["NO", "ğŸ‡³ğŸ‡´"], ["PT", "ğŸ‡µğŸ‡¹"], ["PL", "ğŸ‡µğŸ‡±"], ["GR", "ğŸ‡¬ğŸ‡·"], ["NG", "ğŸ‡³ğŸ‡¬"],
  ["KH", "ğŸ‡°ğŸ‡­"], ["LA", "ğŸ‡±ğŸ‡¦"], ["MN", "ğŸ‡²ğŸ‡³"], ["JO", "ğŸ‡¯ğŸ‡´"], ["IR", "ğŸ‡®ğŸ‡·"],
  ["OM", "ğŸ‡´ğŸ‡²"], ["PS", "ğŸ‡µğŸ‡¸"], ["NP", "ğŸ‡³ğŸ‡µ"], ["LB", "ğŸ‡±ğŸ‡§"], ["IQ", "ğŸ‡®ğŸ‡¶"],
  ["SY", "ğŸ‡¸ğŸ‡¾"], ["QA", "ğŸ‡¶ğŸ‡¦"], ["GE", "ğŸ‡¬ğŸ‡ª"], ["LK", "ğŸ‡±ğŸ‡°"], ["LT", "ğŸ‡±ğŸ‡¹"],
  ["MT", "ğŸ‡²ğŸ‡¹"], ["MC", "ğŸ‡²ğŸ‡¨"], ["HR", "ğŸ‡­ğŸ‡·"], ["LV", "ğŸ‡±ğŸ‡»"], ["SK", "ğŸ‡¸ğŸ‡°"],
  ["PA", "ğŸ‡µğŸ‡¦"], ["PE", "ğŸ‡µğŸ‡ª"], ["PY", "ğŸ‡µğŸ‡¾"], ["JM", "ğŸ‡¯ğŸ‡²"], ["GT", "ğŸ‡¬ğŸ‡¹"],
  ["PR", "ğŸ‡µğŸ‡·"], ["HN", "ğŸ‡­ğŸ‡³"], ["NI", "ğŸ‡³ğŸ‡®"], ["GH", "ğŸ‡¬ğŸ‡­"], ["MA", "ğŸ‡²ğŸ‡¦"],
  ["KE", "ğŸ‡°ğŸ‡ª"], ["SI", "ğŸ‡¸ğŸ‡®"], ["TG", "ğŸ‡¹ğŸ‡¬"]
]);

const obj = JSON.parse($response.body);

const title = `${flags.get(obj.countryCode) || ""} ${validCity(obj.city)}`;
const ip = obj.query;
const subtitle = `${firstWordISP(obj.isp)} Â· ${ip}`;
const description =
  `æœåŠ¡å•†: ${obj.isp}\n` +
  `åœ°åŒº: ${validCity(obj.regionName)}\n` +
  `IP: ${obj.query}\n` +
  `æ—¶åŒº: ${obj.timezone}`;

$done({ title, subtitle, ip, description });
